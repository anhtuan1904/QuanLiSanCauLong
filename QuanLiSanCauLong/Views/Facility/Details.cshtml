@model QuanLiSanCauLong.ViewModels.FacilityDetailsViewModel

<div class="container py-4">
    <div class="row mb-5">
        <div class="col-lg-7">
            <div id="courtCarousel" class="carousel slide rounded-4 overflow-hidden shadow" data-bs-ride="carousel">
                <div class="carousel-inner">
                    @for (int i = 0; i < Model.ImageUrls.Count; i++)
                    {
                        <div class="carousel-item @(i == 0 ? "active" : "")">
                            <img src="@Model.ImageUrls[i]" class="d-block w-100" style="height: 400px; object-fit: cover;">
                        </div>
                    }
                </div>
            </div>
        </div>
        <div class="col-lg-5">
            <h1 class="fw-bold text-dark">@Model.FacilityName</h1>
            <p class="text-muted"><i class="bi bi-geo-alt-fill text-danger"></i> @Model.Address</p>
            <hr>
            <div class="d-flex gap-3 mb-4">
                <div class="p-3 bg-light rounded-3 text-center flex-fill">
                    <span class="small text-muted d-block">Giá từ</span>
                    <strong class="text-success fs-5">80.000đ</strong>
                </div>
                <div class="p-3 bg-light rounded-3 text-center flex-fill">
                    <span class="small text-muted d-block">Trạng thái</span>
                    <strong class="text-primary fs-5">Đang mở cửa</strong>
                </div>
            </div>
            <p>@Model.Description</p>
        </div>
    </div>

    <ul class="nav nav-pills mb-4 bg-white p-2 rounded-pill shadow-sm d-inline-flex" id="bookingTabs">
        <li class="nav-item">
            <button class="nav-link active rounded-pill px-4" data-bs-toggle="tab" data-bs-target="#tab-book">Đặt sân ngay</button>
        </li>
        <li class="nav-item">
            <button class="nav-link rounded-pill px-4" data-bs-toggle="tab" data-bs-target="#tab-history">Lịch đặt của tôi</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="tab-book">
            <div class="card border-0 shadow-sm rounded-4 p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0 fw-bold">Chọn khung giờ trống</h4>
                    <div class="d-flex align-items-center gap-2">
                        <span>Ngày:</span>
                        <input type="date" class="form-control form-control-sm" value="@Model.SelectedDate.ToString("yyyy-MM-dd")" onchange="window.location.href='?id=@Model.FacilityId&date=' + this.value">
                    </div>
                </div>

                <div class="table-responsive">
                    <div class="timeline-wrapper" style="min-width: 1000px;">
                        @foreach (var court in Model.Courts)
                        {
                            <div class="d-flex align-items-center mb-3">
                                <div class="court-label fw-bold pe-3" style="width: 120px;">@court.CourtNumber</div>
                                <div class="slots-row d-flex gap-2">
                                    @foreach (var slot in court.Slots)
                                    {
                                        <div class="slot-item @(slot.IsBooked ? "booked" : "available")"
                                             data-court="@court.CourtNumber"
                                             data-time="@slot.TimeRange"
                                             data-price="@slot.Price"
                                             onclick="toggleSlot(this)">
                                            <span class="time">@slot.TimeRange.Split(" - ")[0]</span>
                                            <span class="price">@(slot.Price / 1000)k</span>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="tab-history">
            <div class="card border-0 shadow-sm rounded-4 p-4">
                <table class="table align-middle">
                    <thead>
                        <tr>
                            <th>Sân</th>
                            <th>Ngày</th>
                            <th>Giờ</th>
                            <th>Trạng thái</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var b in Model.UserBookings)
                        {
                            <tr>
                                <td><strong>@b.CourtName</strong></td>
                                <td>@b.Date.ToString("dd/MM/yyyy")</td>
                                <td>@b.Time</td>
                                <td><span class="badge bg-success">@b.Status</span></td>
                                <td><button class="btn btn-sm btn-outline-danger">Hủy</button></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="paymentBar" class="fixed-bottom bg-dark text-white p-3 shadow-lg d-none animate__animated animate__slideInUp">
    <div class="container d-flex justify-content-between align-items-center">
        <div>
            <span id="selectedSlotsText">Đã chọn 0 khung giờ</span>
            <h4 class="mb-0 text-warning" id="totalAmount">0đ</h4>
        </div>
        <button class="btn btn-warning fw-bold px-5 py-2 rounded-pill">ĐẶT SÂN NGAY</button>
    </div>
</div>

<style>
    .slot-item {
        width: 75px;
        height: 60px;
        border: 1px solid #eee;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: 0.2s;
        background: white;
    }

        .slot-item.available:hover {
            border-color: #6c33f2;
            background: #f3f0ff;
        }

        .slot-item.booked {
            background: #ffebeb;
            color: #ff5b5b;
            cursor: not-allowed;
            border: none;
        }

        .slot-item.selected {
            background: #6c33f2 !important;
            color: white !important;
        }

        .slot-item .time {
            font-weight: bold;
            font-size: 0.9rem;
        }

        .slot-item .price {
            font-size: 0.75rem;
            opacity: 0.8;
        }
</style>

<script>
    let selected = [];
    function toggleSlot(el) {
        if (el.classList.contains('booked')) return;
        el.classList.toggle('selected');

        const price = parseInt(el.dataset.price);
        const time = el.dataset.time;

        // Logic tính tiền đơn giản
        const selectedCount = document.querySelectorAll('.slot-item.selected').length;
        const total = selectedCount * price;

        const bar = document.getElementById('paymentBar');
        if (selectedCount > 0) {
            bar.classList.remove('d-none');
            document.getElementById('selectedSlotsText').innerText = `Đã chọn ${selectedCount} khung giờ`;
            document.getElementById('totalAmount').innerText = total.toLocaleString() + 'đ';
        } else {
            bar.classList.add('d-none');
        }
    }
</script>