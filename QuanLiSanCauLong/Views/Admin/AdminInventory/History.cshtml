@model IEnumerable<dynamic>

@{
    var product = ViewBag.Product;
}

<div class="modal-header border-0 p-4 pb-0">
    <div class="d-flex align-items-center justify-content-between w-100">
        <div class="d-flex align-items-center">
            <div class="bg-light p-2 rounded-3 me-3">
                <i class="bi bi-clock-history text-dark fs-4"></i>
            </div>
            <div>
                <h4 class="fw-bold mb-0">Lịch Sử Kho</h4>
                <p class="text-muted small mb-0">Biến động nhập xuất sản phẩm</p>
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
</div>

<div class="modal-body p-4">
    <div class="card border-0 bg-light rounded-4 mb-4">
        <div class="card-body p-3 d-flex align-items-center">
            <img src="@(product?.ImageUrl ?? "/images/no-image.png")" class="rounded-3 me-3" style="width: 50px; height: 50px; object-fit: cover;" />
            <div>
                <h6 class="fw-bold mb-0">@(product?.ProductName ?? "Sản phẩm")</h6>
                <small class="text-muted">Mã: @(product?.ProductCode ?? "---")</small>
            </div>
            <div class="ms-auto text-end">
                <small class="text-muted d-block small">Hiện tồn</small>
                <span class="fw-bold text-primary">@ViewBag.CurrentStock</span>
            </div>
        </div>
    </div>

    <div class="table-responsive" style="max-height: 350px;">
        <table class="table table-hover align-middle">
            <thead class="table-light small text-uppercase">
                <tr>
                    <th>Ngày</th>
                    <th>Loại</th>
                    <th class="text-center">SL</th>
                    <th>Người thực hiện</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var log in Model)
                    {
                        <tr>
                            <td>
                                <div class="fw-bold" style="font-size: 0.85rem;">@log.TransactionDate.ToString("dd/MM/yyyy")</div>
                                <div class="text-muted small">@log.TransactionDate.ToString("HH:mm")</div>
                            </td>
                            <td>
                                @if (log.Type == "StockIn")
                                {
                                    <span class="badge bg-success-subtle text-success">Nhập</span>
                                }
                                else if (log.Type == "StockOut")
                                {

                                    <span class="badge bg-danger-subtle text-danger">Xuất</span>
                                }
                                else
                                {

                                    <span class="badge bg-warning-subtle text-warning">Lệch</span>
                                }
                            </td>
                            <td class="text-center fw-bold">@log.Quantity</td>
                            <td>
                                <div class="small">@log.UserEmail</div>
                                <div class="text-muted" style="font-size: 0.7rem;">@log.Note</div>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr><td colspan="4" class="text-center py-4 text-muted small">Chưa có giao dịch nào.</td></tr>
                }
            </tbody>
        </table>
    </div>
</div>
<div class="modal-footer border-0 p-4 pt-0">
    <button type="button" class="btn btn-secondary w-100 rounded-3" data-bs-dismiss="modal">Đóng</button>
</div>

<style>
    .bg-success-subtle {
        background-color: #d1e7dd;
        color: #0f5132;
    }

    .bg-danger-subtle {
        background-color: #f8d7da;
        color: #842029;
    }

    .bg-warning-subtle {
        background-color: #fff3cd;
        color: #664d03;
    }
</style>