@model QuanLiSanCauLong.ViewModels.StockTransactionViewModel

<div class="modal-header border-0 pb-0">
    <div class="d-flex align-items-center">
        <div class="bg-danger text-white rounded-3 p-2 me-3">
            <i class="bi bi-box-arrow-up fs-4"></i>
        </div>
        <div>
            <h5 class="modal-title fw-bold">Tạo Phiếu Xuất Kho</h5>
            <p class="text-muted small mb-0">Xuất hàng cho khách hoặc điều chuyển nội bộ</p>
        </div>
    </div>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<form asp-action="StockOut" method="post" id="stockOutForm">
    <div class="modal-body p-4">
        <div class="row g-3 mb-4">
            <div class="col-md-7">
                <label class="form-label small fw-bold text-muted">CƠ SỞ XUẤT HÀNG</label>
                <select asp-for="FacilityId" class="form-select border-0 bg-light rounded-3 py-2">
                    <option value="">-- Chọn cơ sở --</option>
                    @* Load từ dữ liệu của bạn *@
                </select>
            </div>
            <div class="col-md-5">
                <label class="form-label small fw-bold text-muted">NGÀY THỰC HIỆN</label>
                <input asp-for="TransactionDate" type="date" class="form-control border-0 bg-light rounded-3 py-2" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-2">
            <label class="form-label small fw-bold text-muted mb-0"><i class="bi bi-list-ul me-1"></i> CHI TIẾT SẢN PHẨM XUẤT</label>
            <button type="button" class="btn btn-sm btn-soft-danger" onclick="addRow()">
                <i class="bi bi-plus-circle me-1"></i>Thêm dòng
            </button>
        </div>

        <div class="table-responsive">
            <table class="table table-borderless align-middle" id="productTable">
                <thead>
                    <tr class="text-muted small border-bottom">
                        <th style="width: 55%">Sản phẩm</th>
                        <th style="width: 35%">Số lượng xuất</th>
                        <th style="width: 10%" class="text-center">Xóa</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="product-row">
                        <td>
                            <select name="Items[0].ProductId" class="form-select border-0 bg-light rounded-3 py-2">
                                <option value="">-- Chọn sản phẩm --</option>
                            </select>
                        </td>
                        <td>
                            <input name="Items[0].Quantity" type="number" class="form-control border-0 bg-light rounded-3 py-2" placeholder="Tồn: 0" min="1" />
                        </td>
                        <td class="text-center">
                            <button type="button" class="btn btn-link text-danger p-0" onclick="removeRow(this)">
                                <i class="bi bi-trash3"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="mt-3">
            <label class="form-label small fw-bold text-muted">LÝ DO XUẤT KHO</label>
            <textarea asp-for="Note" class="form-control border-0 bg-light rounded-3" rows="2" placeholder="Bán lẻ, hàng hỏng, chuyển kho..."></textarea>
        </div>
    </div>

    <div class="modal-footer border-0 bg-light-subtle p-4">
        <button type="button" class="btn btn-link text-decoration-none text-secondary" data-bs-dismiss="modal">Hủy bỏ</button>
        <button type="submit" class="btn btn-danger rounded-3 px-4 shadow-sm">
            <i class="bi bi-box-arrow-up me-2"></i>Xác nhận xuất kho
        </button>
    </div>
</form>

<style>
    .btn-soft-danger {
        background-color: #fff5f5;
        color: #dc3545;
        border: none;
        font-weight: 600;
        font-size: 0.75rem;
    }

        .btn-soft-danger:hover {
            background-color: #dc3545;
            color: white;
        }
</style>

<script>
    // Tái sử dụng logic addRow/removeRow giống bên Nhập kho
    let rowIndexOut = 1;
    function addRow() {
        const row = `
            <tr class="product-row">
                <td>
                    <select name="Items[${rowIndexOut}].ProductId" class="form-select border-0 bg-light rounded-3 py-2">
                        <option value="">-- Chọn sản phẩm --</option>
                    </select>
                </td>
                <td>
                    <input name="Items[${rowIndexOut}].Quantity" type="number" class="form-control border-0 bg-light rounded-3 py-2" placeholder="0" min="1" />
                </td>
                <td class="text-center">
                    <button type="button" class="btn btn-link text-danger p-0" onclick="removeRow(this)">
                        <i class="bi bi-trash3"></i>
                    </button>
                </td>
            </tr>`;
        $('#productTable tbody').append(row);
        rowIndexOut++;
    }

    function removeRow(btn) {
        if ($('.product-row').length > 1) {
            $(btn).closest('tr').remove();
        }
    }
</script>