@model QuanLiSanCauLong.ViewModels.AdminDashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="container-fluid px-4 py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold mb-0">Dashboard</h3>
    </div>

    <!-- KPI Cards Row 1 -->
    <div class="row g-3 mb-4">
        <!-- Total Revenue -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="icon-box bg-success-subtle rounded-3 p-3">
                            <i class="bi bi-currency-dollar text-success fs-4"></i>
                        </div>
                        <span class="badge bg-success-subtle text-success">+12.5%</span>
                    </div>
                    <h2 class="fw-bold mb-1">₫@Model.TotalRevenue.ToString("N0")</h2>
                    <p class="text-muted mb-0 small">Tổng Doanh Thu</p>
                </div>
            </div>
        </div>

        <!-- Today Orders -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="icon-box bg-primary-subtle rounded-3 p-3">
                            <i class="bi bi-bag-check text-primary fs-4"></i>
                        </div>
                        <span class="badge bg-primary-subtle text-primary">+8.2%</span>
                    </div>
                    <h2 class="fw-bold mb-1">@Model.TotalBookings</h2>
                    <p class="text-muted mb-0 small">Đơn Hàng Hôm Nay</p>
                </div>
            </div>
        </div>

        <!-- New Customers -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="icon-box bg-pink-subtle rounded-3 p-3">
                            <i class="bi bi-people text-pink fs-4"></i>
                        </div>
                        <span class="badge bg-pink-subtle text-pink">+15.3%</span>
                    </div>
                    <h2 class="fw-bold mb-1">@Model.TotalCustomers</h2>
                    <p class="text-muted mb-0 small">Khách Hàng Mới</p>
                </div>
            </div>
        </div>

        <!-- Court Usage Rate -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="icon-box bg-warning-subtle rounded-3 p-3">
                            <i class="bi bi-graph-up-arrow text-warning fs-4"></i>
                        </div>
                        <span class="badge bg-warning-subtle text-warning">+4.1%</span>
                    </div>
                    <h2 class="fw-bold mb-1">87%</h2>
                    <p class="text-muted mb-0 small">Tỷ Lệ Sử Dụng Sân</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row g-4 mb-4">
        <!-- Revenue Chart -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="fw-bold mb-1">Doanh Thu & Đơn Hàng</h5>
                    <p class="text-muted small mb-0">Thống kê theo tháng</p>
                </div>
                <div class="card-body">
                    <canvas id="revenueChart" height="280"></canvas>
                </div>
            </div>
        </div>

        <!-- Court Usage Chart -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="fw-bold mb-1">Tỷ Lệ Sử Dụng Sân</h5>
                    <p class="text-muted small mb-0">Số giờ sử dụng trong tháng</p>
                </div>
                <div class="card-body">
                    <canvas id="courtUsageChart" height="280"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Time Slots & Revenue Breakdown Row -->
    <div class="row g-4 mb-4">
        <!-- Popular Time Slots -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="fw-bold mb-1">Đặt Sân Theo Khung Giờ</h5>
                    <p class="text-muted small mb-0">Phân bố lượt đặt trong ngày</p>
                </div>
                <div class="card-body">
                    <canvas id="timeSlotsChart" height="280"></canvas>
                </div>
            </div>
        </div>

        <!-- Revenue by Category -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="fw-bold mb-1">Doanh Số Theo Danh Mục</h5>
                    <p class="text-muted small mb-0">Phần trăm đóng góp doanh thu</p>
                </div>
                <div class="card-body">
                    <canvas id="categoryChart" height="280"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Orders & Top Products -->
    <div class="row g-4 mb-4">
        <!-- Recent Orders -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="fw-bold mb-1">Đơn Hàng Gần Đây</h5>
                    <p class="text-muted small mb-0">Các đơn hàng mới nhất</p>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <tbody>
                                <tr>
                                    <td class="border-0 py-3">
                                        <div class="d-flex align-items-center">
                                            <span class="badge bg-success me-3">#ORD-2001</span>
                                            <div>
                                                <div class="fw-semibold">Nguyễn Văn A</div>
                                                <small class="text-muted">Vợt Yonex Astrox 99</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="border-0 py-3 text-end">
                                        <div class="fw-bold text-success">₫3,500,000</div>
                                        <span class="badge bg-success-subtle text-success">Hoàn Thành</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="border-0 py-3">
                                        <div class="d-flex align-items-center">
                                            <span class="badge bg-warning me-3">#ORD-2002</span>
                                            <div>
                                                <div class="fw-semibold">Trần Thị B</div>
                                                <small class="text-muted">Giày Victor P9200</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="border-0 py-3 text-end">
                                        <div class="fw-bold text-success">₫2,800,000</div>
                                        <span class="badge bg-warning-subtle text-warning">Chờ Xử Lý</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="border-0 py-3">
                                        <div class="d-flex align-items-center">
                                            <span class="badge bg-success me-3">#ORD-2003</span>
                                            <div>
                                                <div class="fw-semibold">Lê Văn C</div>
                                                <small class="text-muted">Đặt Sân 2 - 18h</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="border-0 py-3 text-end">
                                        <div class="fw-bold text-success">₫150,000</div>
                                        <span class="badge bg-success-subtle text-success">Hoàn Thành</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="border-0 py-3">
                                        <div class="d-flex align-items-center">
                                            <span class="badge bg-primary me-3">#ORD-2004</span>
                                            <div>
                                                <div class="fw-semibold">Phạm Thị D</div>
                                                <small class="text-muted">Combo 10 buổi</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="border-0 py-3 text-end">
                                        <div class="fw-bold text-success">₫1,200,000</div>
                                        <span class="badge bg-primary-subtle text-primary">Đang Xử Lý</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Products -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="fw-bold mb-1">Sản Phẩm Bán Chạy</h5>
                    <p class="text-muted small mb-0">Top sản phẩm theo doanh thu</p>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        @if (Model.TopProducts != null && Model.TopProducts.Any())
                        {
                            var rank = 1;
                            foreach (var product in Model.TopProducts.Take(4))
                            {
                                <div class="list-group-item border-0 py-3">
                                    <div class="d-flex align-items-center">
                                        <div class="rank-badge me-3">
                                            <span class="badge rounded-circle bg-success text-white" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">@rank</span>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="fw-semibold">@product.ProductName</div>
                                            <small class="text-muted">@product.QuantitySold sản phẩm đã bán</small>
                                        </div>
                                        <div class="text-end">
                                            <div class="fw-bold text-success">₫@product.Revenue.ToString("N0")</div>
                                        </div>
                                    </div>
                                </div>
                                rank++;
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Row -->
    <div class="row g-3">
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center py-4">
                    <div class="icon-box-large bg-primary-subtle rounded-3 p-3 d-inline-flex mb-3">
                        <i class="bi bi-building text-primary fs-3"></i>
                    </div>
                    <h3 class="fw-bold mb-1">6</h3>
                    <p class="text-muted mb-0 small">Cơ Sở Sân</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center py-4">
                    <div class="icon-box-large bg-pink-subtle rounded-3 p-3 d-inline-flex mb-3">
                        <i class="bi bi-box-seam text-pink fs-3"></i>
                    </div>
                    <h3 class="fw-bold mb-1">142</h3>
                    <p class="text-muted mb-0 small">Sản Phẩm</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center py-4">
                    <div class="icon-box-large bg-success-subtle rounded-3 p-3 d-inline-flex mb-3">
                        <i class="bi bi-calendar-check text-success fs-3"></i>
                    </div>
                    <h3 class="fw-bold mb-1">89</h3>
                    <p class="text-muted mb-0 small">Đặt Hôm Nay</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center py-4">
                    <div class="icon-box-large bg-warning-subtle rounded-3 p-3 d-inline-flex mb-3">
                        <i class="bi bi-clock text-warning fs-3"></i>
                    </div>
                    <h3 class="fw-bold mb-1">12</h3>
                    <p class="text-muted mb-0 small">Chờ Xác Nhận</p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // Revenue & Orders Chart
        const revenueCtx = document.getElementById('revenueChart').getContext('2d');
        new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8'],
                datasets: [{
                    label: 'Doanh Thu',
                    data: [2800000, 3200000, 2900000, 3500000, 3800000, 3300000, 4200000, 4000000],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Court Usage Chart
        const courtCtx = document.getElementById('courtUsageChart').getContext('2d');
        new Chart(courtCtx, {
            type: 'bar',
            data: {
                labels: ['Sân 1', 'Sân 2', 'Sân 3', 'Sân 4', 'Sân 5', 'Sân 6'],
                datasets: [{
                    label: 'Giờ sử dụng',
                    data: [145, 130, 125, 155, 98, 145],
                    backgroundColor: '#10b981',
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Time Slots Chart
        const timeSlotsCtx = document.getElementById('timeSlotsChart').getContext('2d');
        new Chart(timeSlotsCtx, {
            type: 'line',
            data: {
                labels: ['6h-8h', '8h-10h', '10h-12h', '12h-14h', '14h-16h', '16h-18h', '18h-20h', '20h-22h'],
                datasets: [{
                    label: 'Lượt Đặt',
                    data: [45, 38, 28, 22, 35, 52, 68, 58],
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'Lượt Đặt: ' + context.parsed.y;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Category Revenue Chart
        const categoryCtx = document.getElementById('categoryChart').getContext('2d');
        new Chart(categoryCtx, {
            type: 'doughnut',
            data: {
                labels: ['Vợt', 'Giày', 'Phụ Kiện', 'Quần Áo'],
                datasets: [{
                    data: [35, 28, 15, 22],
                    backgroundColor: [
                        '#10b981',
                        '#6366f1',
                        '#f59e0b',
                        '#ec4899'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true
                        }
                    }
                }
            }
        });
    </script>
}

<style>
    .icon-box {
        width: 56px;
        height: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .icon-box-large {
        width: 64px;
        height: 64px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .bg-success-subtle {
        background-color: rgba(16, 185, 129, 0.1) !important;
    }

    .bg-primary-subtle {
        background-color: rgba(99, 102, 241, 0.1) !important;
    }

    .bg-pink-subtle {
        background-color: rgba(236, 72, 153, 0.1) !important;
    }

    .bg-warning-subtle {
        background-color: rgba(245, 158, 11, 0.1) !important;
    }

    .text-pink {
        color: #ec4899 !important;
    }

    .badge {
        font-weight: 600;
        padding: 0.35rem 0.65rem;
    }

    .card {
        transition: transform 0.2s, box-shadow 0.2s;
    }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1) !important;
        }
</style>
